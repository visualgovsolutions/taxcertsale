#!/bin/bash
. "$(dirname "$0")/_/husky.sh"

VERSION_FILE="VERSION"

if [ ! -f "$VERSION_FILE" ]; then
  echo "0.1.0" > "$VERSION_FILE"
fi

# Read current version and split into parts
VERSION=$(cat "$VERSION_FILE")
IFS='.' read -r MAJOR MINOR PATCH <<< "$VERSION"

# Bump patch version
PATCH=$((PATCH + 1))
NEW_VERSION="${MAJOR}.${MINOR}.${PATCH}"

# Save new version
echo "$NEW_VERSION" > "$VERSION_FILE"

# Get commit hash
COMMIT_HASH=$(git rev-parse --short HEAD)

# Tag format: v1.2.4+abc1234
TAG="v${NEW_VERSION}+${COMMIT_HASH}"

git tag "$TAG"

echo "âœ… Version bumped to $NEW_VERSION and tagged as $TAG"

# Stage the VERSION file for the next commit
git add "$VERSION_FILE" 